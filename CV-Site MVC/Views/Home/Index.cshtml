@addTagHelper*, Microsoft.AspNetCore.Mvc.TagHelpers
@using CV_Site_MVC.Models
@model IndexViewModel


<div class="container">
	@if (Model.listOfCV.Count() > 0)
	{
		@if (User.Identity.IsAuthenticated)
		{
			
				<div class="row pb-3">
					<div class="col-lg-8">
						<h3 class="text-brand">CV</h3>
					</div>
			</div>			
				<div class="row">
					
					@{var ran = new Random();}
					@foreach (CV cV in Model.listOfCV.OrderBy(x => ran.Next()).Take(3))
					{
						<div class="col-md-3">
						<div class="CV p-4 bg-light rounded shadow p-3 mb-5 bg-white rounded">
							<h4>CV</h4>
							<h6 class="text-dark font-weight-bold">Användarnamn:</h6>
							<h6>@cV.User.UserName</h6>
							<a class="text-dark" asp-controller="CV" asp-action="CV" asp-route-id="@cV.UserID">Till CV</a>
						</div>
						</div>
					}
				</div>
			
		}
		else
		{
			<div class="row pb-3">
				<div class="col-lg-8">
					<h3 class="text-brand">CV</h3>
				</div>
			</div>
			<div class="row">

				@{
					var ran = new Random();
				}
				@foreach (var user in Model.PrivateCVUser.OrderBy(x => ran.Next()).Take(3))
				{
					<div class="col-md-3">
						<div class="CV p-4 bg-light rounded shadow p-3 mb-5 bg-white rounded">
							<h4>CV</h4>
							<h6 class="text-dark font-weight-bold">Användarnamn:</h6>
							<h6>@user.UserName</h6>
							<a class="text-dark" asp-controller="CV" asp-action="CV" asp-route-id="@user.Id">Till CV</a>
						</div>
					</div>
				}
			</div>
		}
	}
</div>

<div>
	<h3>Projekt</h3>
	@if (Model.lastProject != null)
	{
		<table class="table-bordered">
			<thead>
				<tr class="font-weight-bold">
					<td>Projektnamn</td>
					<td>Beskrivning</td>
					<td>Startdatum</td>
					<td>Slutdatum</td>
					<td>Projektledare</td>
					<td>Personer med i projektet</td>

				</tr>
			</thead>
			<tbody>

				<tr>
					<td>@Model.lastProject.ProjectName</td>
					<td>@Model.lastProject.Description</td>
					<td>@Model.lastProject.StartDate</td>
					<td>@Model.lastProject.EndDate</td>
					<td>@Model.lastProject.User.UserName</td>
					@if (User.Identity.IsAuthenticated)
					{
						<td>
							@foreach (var users in Model.UserInProjects.Where(x => x.ProjektID == Model.lastProject.Id))
							{
								@users.User.UserName
							}
						</td>
					}
					else
					{
						<td>
							@foreach(var users in Model.UsersWithPrivateCV.Where(x => x.ProjektID == Model.lastProject.Id))
							{
								@users.User.UserName
							}
						</td>
					}
					<td>
						@if (User.Identity.IsAuthenticated)
						{
							@if (Model.UserInProjects.Where(x => x.User.UserName.Equals(User.Identity.Name) && x.ProjektID == Model.lastProject.Id).FirstOrDefault() == null)
							{
								<td>
									<form method="post" asp-controller="Home" asp-action="JoinProject" asp-route-projId="@Model.lastProject.Id">
										<button type="submit">Gå med</button>
									</form>
								</td>
							}
							else
							{
								<td>
									<form method="post" asp-controller="Home" asp-action="RemoveProject" asp-route-projId="@Model.lastProject.Id">
										<button type="submit">Gå ur</button>
									</form>
								</td>
							}
						}
					</td>
				</tr>

			</tbody>
		</table>
	}
</div>




@*@{
	ViewData["Title"] = "Home Page";
}

<div class="text-center">
	<h1 class="display-4">Welcome</h1>
	<p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>*@