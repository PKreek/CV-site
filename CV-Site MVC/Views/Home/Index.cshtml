@addTagHelper*, Microsoft.AspNetCore.Mvc.TagHelpers
@using CV_Site_MVC.Models
@model IndexViewModel

<div>
	<h3>CV</h3>
	@if(Model.listOfCV.Count() > 0)
	{
		<table class="table-bordered">
			<thead>
				<tr class="font-weight-bold">
					<td>Användare</td>
					<td>Gå till CV</td>		
				</tr>
			</thead>
				<tbody>
				@if(User.Identity.IsAuthenticated)
			    {
					@foreach (CV cV in Model.listOfCV)
					{
						<tr>
						<td>@cV.User.UserName</td>
						<td><a asp-controller="CV" asp-action="CV" asp-route-id="@cV.UserID">Till CV</a></td>
						</tr>							
					}
			    }
				else
				{
					
					@foreach(var user in Model.PrivateCVUser)
					{
						<tr>
						<td>@user.UserName</td>
						<td><a asp-controller="CV" asp-action="CV" asp-route-id="@user.Id">Till CV</a></td>
						</tr>
					}
					
				}
				
				</tbody>
		</table>
	}
	</div>
<div>
	<h3>Projekt</h3>
	@if (Model.lastProject != null)
	{
		<table class="table-bordered">
			<thead>
				<tr class="font-weight-bold">
					<td>Projektnamn</td>
					<td>Beskrivning</td>
					<td>Startdatum</td>
					<td>Slutdatum</td>
					<td>Projektledare</td>
					<td>Personer med i projektet</td>

				</tr>
			</thead>
			<tbody>

				<tr>
					<td>@Model.lastProject.ProjectName</td>
					<td>@Model.lastProject.Description</td>
					<td>@Model.lastProject.StartDate</td>
					<td>@Model.lastProject.EndDate</td>
					<td>@Model.lastProject.User.UserName</td>
					@if (User.Identity.IsAuthenticated)
					{
						<td>
							@foreach (var users in Model.UserInProjects.Where(x => x.ProjektID == Model.lastProject.Id))
							{
								@users.User.UserName
							}
						</td>
					}
					else
					{
						<td>
							@foreach(var users in Model.UsersWithPrivateCV.Where(x => x.ProjektID == Model.lastProject.Id))
							{
								@users.User.UserName
							}
						</td>
					}
					<td>
						@if (User.Identity.IsAuthenticated)
						{
							@if (Model.UserInProjects.Where(x => x.User.UserName.Equals(User.Identity.Name) && x.ProjektID == Model.lastProject.Id).FirstOrDefault() == null)
							{
								<td>
									<form method="post" asp-controller="Home" asp-action="JoinProject" asp-route-projId="@Model.lastProject.Id">
										<button type="submit">Gå med</button>
									</form>
								</td>
							}
							else
							{
								<td>
									<form method="post" asp-controller="Home" asp-action="RemoveProject" asp-route-projId="@Model.lastProject.Id">
										<button type="submit">Gå ur</button>
									</form>
								</td>
							}
						}
					</td>
				</tr>

			</tbody>
		</table>
	}
</div>




@*@{
	ViewData["Title"] = "Home Page";
}

<div class="text-center">
	<h1 class="display-4">Welcome</h1>
	<p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>*@